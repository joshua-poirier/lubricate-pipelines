FROM mcr.microsoft.com/azure-functions/python:4-python3.10

# Environment settings
ENV AzureWebJobsScriptRoot=/home/site/wwwroot
ENV AzureFunctionsJobHost__Logging__Console__IsEnabled=true

# System updates
RUN apt-get update

# Copy code into image
COPY Pipfile Pipfile.lock ./
COPY . /home/site/wwwroot

# Install/update Pip and pipenv
RUN python -m pip install --upgrade pip && \
    pip install pipenv

# Install virtual environment
RUN pipenv install --dev --system --deploy
